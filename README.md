# Gismis - åŠ¨æ¼«è¿½ç•ªåŠ©æ‰‹

<div align="center">

![Gismis Logo](logo/2/pink.png)

ä¸€ä¸ªç°ä»£åŒ–çš„åŠ¨æ¼«è¿½ç•ªåº”ç”¨ï¼ŒåŸºäº Flutter å’Œ Supabase æ„å»º

[![Flutter](https://img.shields.io/badge/Flutter-3.0+-02569B?logo=flutter)](https://flutter.dev)
[![Supabase](https://img.shields.io/badge/Supabase-Backend-3ECF8E?logo=supabase)](https://supabase.com)
[![TMDB](https://img.shields.io/badge/TMDB-Data%20Source-01D277?logo=themoviedatabase)](https://www.themoviedb.org)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„) â€¢ [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)

</div>

---

## ğŸ“± åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **åŠ¨æ¼«æµè§ˆ** - åŸºäº TMDB çš„æµ·é‡åŠ¨æ¼«æ•°æ®åº“ï¼Œæ”¯æŒåˆ†é¡µåŠ è½½
- **æ™ºèƒ½æœç´¢** - å¿«é€Ÿæœç´¢åŠ¨æ¼«ï¼Œæ”¯æŒä¸­æ–‡ã€æ—¥æ–‡æ ‡é¢˜
- **è¯¦æƒ…æŸ¥çœ‹** - å®Œæ•´çš„åŠ¨æ¼«ä¿¡æ¯å±•ç¤ºï¼ŒåŒ…æ‹¬ç®€ä»‹ã€è¯„åˆ†ã€çŠ¶æ€ç­‰
- **æ”¶è—ç®¡ç†** - æœ¬åœ°ä¼˜å…ˆçš„æ”¶è—ç³»ç»Ÿï¼Œæ”¯æŒç¦»çº¿è®¿é—®
- **è§‚çœ‹å†å²** - è‡ªåŠ¨è®°å½•è§‚çœ‹è¿›åº¦ï¼Œè·¨è®¾å¤‡åŒæ­¥
- **ç•ªå‰§æ—¶é—´è¡¨** - æŒ‰æ˜ŸæœŸåˆ†ç»„çš„æ–°ç•ªæ’­æ”¾æ—¶é—´è¡¨

### AI åŠ©æ‰‹
- **æ™ºèƒ½å¯¹è¯** - åŸºäº DeepSeek çš„ AI åŠ©æ‰‹ï¼Œæä¾›åŠ¨æ¼«æ¨èå’Œé—®ç­”
- **æµå¼å“åº”** - SSE å®æ—¶æµå¼è¾“å‡ºï¼Œä½“éªŒæµç•…
- **çƒ­é—¨é—®é¢˜** - é¢„è®¾å¸¸è§é—®é¢˜ï¼Œå¿«é€Ÿè·å–ç­”æ¡ˆ
- **ä¸ªæ€§åŒ–æ¨è** - åŸºäºç”¨æˆ·è§‚çœ‹å†å²çš„æ™ºèƒ½æ¨è

### ç”¨æˆ·ä½“éªŒ
- **ç¦»çº¿ä¼˜å…ˆ** - ç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼Œæ”¯æŒç¦»çº¿æµè§ˆ
- **è‡ªåŠ¨åˆ·æ–°** - åå°è‡ªåŠ¨æ›´æ–°ç¼“å­˜æ•°æ®
- **å“åº”å¼è®¾è®¡** - é€‚é…å¤šç§å±å¹•å°ºå¯¸
- **æµç•…åŠ¨ç”»** - ç²¾å¿ƒè®¾è®¡çš„è¿‡æ¸¡åŠ¨ç”»å’Œäº¤äº’æ•ˆæœ

---

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯ (Flutter)
- **æ¡†æ¶**: Flutter 3.0+
- **çŠ¶æ€ç®¡ç†**: Riverpod
- **ç½‘ç»œè¯·æ±‚**: Dio
- **æœ¬åœ°å­˜å‚¨**: Hive
- **å®‰å…¨å­˜å‚¨**: flutter_secure_storage
- **è·¯ç”±**: go_router

### åç«¯ (Supabase)
- **Edge Functions**: Deno Runtime
- **æ•°æ®åº“**: PostgreSQL
- **è®¤è¯**: Supabase Auth (JWT)
- **å­˜å‚¨**: Supabase Storage
- **å®æ—¶**: PostgreSQL RLS

### æ•°æ®æº
- **TMDB API** - åŠ¨æ¼«å…ƒæ•°æ®ã€æµ·æŠ¥ã€è¯„åˆ†
- **DeepSeek AI** - AI å¯¹è¯å’Œæ¨è

### å¼€å‘å·¥å…·
- **æµ‹è¯•**: Property-Based Testing (PBT)
- **ä»£ç è´¨é‡**: Dart Analyzer
- **CI/CD**: GitHub Actions (å¾…é…ç½®)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Flutter SDK 3.0+
- Dart SDK 3.0+
- Supabase CLI
- Node.js 18+ (ç”¨äº Edge Functions)
- Docker (å¯é€‰ï¼Œç”¨äºæœ¬åœ° Supabase)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**
```bash
git clone https://github.com/yourusername/gismis.git
cd gismis
```

2. **å®‰è£… Flutter ä¾èµ–**
```bash
cd gismis
flutter pub get
```

3. **é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `gismis/.env` æ–‡ä»¶ï¼š
```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
```

åˆ›å»º `supabase/functions/.env` æ–‡ä»¶ï¼š
```env
TMDB_API_TOKEN=your-tmdb-bearer-token
DEEPSEEK_API_KEY=your-deepseek-api-key
DEEPSEEK_API_URL=https://api.deepseek.com
```

4. **å¯åŠ¨ Supabase æœ¬åœ°ç¯å¢ƒ** (å¯é€‰)
```bash
cd supabase
supabase start
```

5. **éƒ¨ç½² Edge Functions**
```bash
cd supabase
supabase functions deploy get-anime-list
supabase functions deploy get-anime-detail
supabase functions deploy search-anime
supabase functions deploy ai-chat
supabase functions deploy ai-hot-questions
# ... éƒ¨ç½²å…¶ä»–å‡½æ•°
```

6. **è¿è¡Œåº”ç”¨**
```bash
cd gismis
flutter run
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
gismis/
â”œâ”€â”€ gismis/                      # Flutter åº”ç”¨
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ app/                 # åº”ç”¨é…ç½®å’Œè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ router.dart      # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ theme/           # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ network/         # ç½‘ç»œå±‚ (Dio, SSE)
â”‚   â”‚   â”‚   â”œâ”€â”€ storage/         # å­˜å‚¨å±‚ (Hive, Secure Storage)
â”‚   â”‚   â”‚   â””â”€â”€ supabase/        # Supabase å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ features/            # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ home/            # é¦–é¡µ (åŠ¨æ¼«åˆ—è¡¨)
â”‚   â”‚   â”‚   â”œâ”€â”€ anime_detail/    # åŠ¨æ¼«è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ search/          # æœç´¢
â”‚   â”‚   â”‚   â”œâ”€â”€ favorites/       # æ”¶è—
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule/        # æ—¶é—´è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_assistant/    # AI åŠ©æ‰‹
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/         # ç”¨æˆ·èµ„æ–™
â”‚   â”‚   â”‚   â””â”€â”€ auth/            # è®¤è¯
â”‚   â”‚   â””â”€â”€ shared/              # å…±äº«ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”‚       â””â”€â”€ widgets/         # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ test/                    # æµ‹è¯•
â”‚       â”œâ”€â”€ unit/                # å•å…ƒæµ‹è¯•
â”‚       â”œâ”€â”€ property/            # å±æ€§æµ‹è¯• (PBT)
â”‚       â””â”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ supabase/                    # Supabase åç«¯
â”‚   â”œâ”€â”€ functions/               # Edge Functions
â”‚   â”‚   â”œâ”€â”€ get-anime-list/      # è·å–åŠ¨æ¼«åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ get-anime-detail/    # è·å–åŠ¨æ¼«è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ search-anime/        # æœç´¢åŠ¨æ¼«
â”‚   â”‚   â”œâ”€â”€ ai-chat/             # AI èŠå¤©
â”‚   â”‚   â”œâ”€â”€ get-favorites/       # è·å–æ”¶è—
â”‚   â”‚   â”œâ”€â”€ sync-favorites/      # åŒæ­¥æ”¶è—
â”‚   â”‚   â””â”€â”€ _shared/             # å…±äº«ä»£ç 
â”‚   â”‚       â”œâ”€â”€ adapters/        # æ•°æ®é€‚é…å™¨ (TMDB)
â”‚   â”‚       â”œâ”€â”€ aggregator/      # æ•°æ®èšåˆå™¨
â”‚   â”‚       â”œâ”€â”€ auth.ts          # JWT è®¤è¯
â”‚   â”‚       â”œâ”€â”€ cors.ts          # CORS å¤„ç†
â”‚   â”‚       â””â”€â”€ response.ts      # å“åº”æ ¼å¼åŒ–
â”‚   â””â”€â”€ migrations/              # æ•°æ®åº“è¿ç§»
â”‚
â””â”€â”€ docs/                        # æ–‡æ¡£
    â”œâ”€â”€ TMDB.md                  # TMDB API æ–‡æ¡£
    â”œâ”€â”€ edge-functions-verification.md  # API æµ‹è¯•æŒ‡å—
    â””â”€â”€ timeline.md              # å¼€å‘æ—¶é—´çº¿
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd gismis
flutter test

# è¿è¡Œå•å…ƒæµ‹è¯•
flutter test test/unit/

# è¿è¡Œå±æ€§æµ‹è¯• (PBT)
flutter test test/property/

# è¿è¡Œé›†æˆæµ‹è¯•
flutter test test/integration/
```

### ä»£ç è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ Dart å®˜æ–¹ä»£ç è§„èŒƒï¼Œé…ç½®åœ¨ `analysis_options.yaml`ï¼š

```bash
# åˆ†æä»£ç 
flutter analyze

# æ ¼å¼åŒ–ä»£ç 
dart format .
```

### Edge Functions å¼€å‘

```bash
# æœ¬åœ°æµ‹è¯• Edge Function
cd supabase
supabase functions serve get-anime-list --env-file functions/.env

# æµ‹è¯• API
curl http://localhost:54321/functions/v1/get-anime-list?page=1
```

### æ•°æ®åº“è¿ç§»

```bash
# åˆ›å»ºæ–°è¿ç§»
supabase migration new migration_name

# åº”ç”¨è¿ç§»
supabase db push

# é‡ç½®æ•°æ®åº“
supabase db reset
```

---

## ğŸŒ API ç«¯ç‚¹

### åŠ¨æ¼«ç›¸å…³
- `GET /functions/v1/get-anime-list` - è·å–åŠ¨æ¼«åˆ—è¡¨
- `GET /functions/v1/get-anime-detail/:id` - è·å–åŠ¨æ¼«è¯¦æƒ…
- `GET /functions/v1/search-anime` - æœç´¢åŠ¨æ¼«
- `GET /functions/v1/get-schedule` - è·å–ç•ªå‰§æ—¶é—´è¡¨

### ç”¨æˆ·ç›¸å…³
- `GET /functions/v1/get-favorites` - è·å–æ”¶è—åˆ—è¡¨ (éœ€è®¤è¯)
- `POST /functions/v1/sync-favorites` - åŒæ­¥æ”¶è— (éœ€è®¤è¯)
- `GET /functions/v1/get-profile` - è·å–ç”¨æˆ·èµ„æ–™ (éœ€è®¤è¯)
- `PUT /functions/v1/update-profile` - æ›´æ–°ç”¨æˆ·èµ„æ–™ (éœ€è®¤è¯)
- `POST /functions/v1/upload-avatar` - ä¸Šä¼ å¤´åƒ (éœ€è®¤è¯)

### AI åŠ©æ‰‹
- `POST /functions/v1/ai-chat` - AI èŠå¤© (SSE æµå¼)
- `GET /functions/v1/ai-hot-questions` - è·å–çƒ­é—¨é—®é¢˜

### è§‚çœ‹å†å²
- `GET /functions/v1/get-watch-history` - è·å–è§‚çœ‹å†å² (éœ€è®¤è¯)
- `POST /functions/v1/update-watch-progress` - æ›´æ–°è§‚çœ‹è¿›åº¦ (éœ€è®¤è¯)

è¯¦ç»† API æ–‡æ¡£è¯·å‚è€ƒ [docs/edge-functions-verification.md](docs/edge-functions-verification.md)

---

## ğŸ¨ è®¾è®¡ç†å¿µ

### æ¶æ„åŸåˆ™
- **Clean Architecture** - æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œä¸šåŠ¡é€»è¾‘ä¸ UI åˆ†ç¦»
- **Repository Pattern** - ç»Ÿä¸€çš„æ•°æ®è®¿é—®å±‚
- **Provider Pattern** - ä½¿ç”¨ Riverpod è¿›è¡Œä¾èµ–æ³¨å…¥å’ŒçŠ¶æ€ç®¡ç†
- **Cache-First** - ç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### æ•°æ®æµ
```
UI Layer (Widgets)
    â†“
Domain Layer (Providers)
    â†“
Data Layer (Repositories)
    â†“
Network/Cache (Dio/Hive)
```

### æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•** - æµ‹è¯•ç‹¬ç«‹å‡½æ•°å’Œç±»
- **å±æ€§æµ‹è¯• (PBT)** - éªŒè¯é€šç”¨å±æ€§å’Œä¸å˜é‡
- **é›†æˆæµ‹è¯•** - æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹

---

## ğŸ” ç¯å¢ƒå˜é‡

### Flutter åº”ç”¨ (`gismis/.env`)
```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
```

### Edge Functions (`supabase/functions/.env`)
```env
# TMDB API
TMDB_API_TOKEN=your-tmdb-bearer-token

# DeepSeek AI
DEEPSEEK_API_KEY=your-deepseek-api-key
DEEPSEEK_API_URL=https://api.deepseek.com

# Supabase (è‡ªåŠ¨æ³¨å…¥)
SUPABASE_URL=auto-injected
SUPABASE_SERVICE_ROLE_KEY=auto-injected
SUPABASE_ANON_KEY=auto-injected
```

---

## ğŸ“ å¾…åŠäº‹é¡¹

- [ ] å®Œå–„ç”¨æˆ·è®¤è¯æµç¨‹
- [ ] æ·»åŠ ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- [ ] å®ç°è¯„è®ºç³»ç»Ÿ
- [ ] æ”¯æŒå¤šè¯­è¨€ (i18n)
- [ ] æ·»åŠ æ·±è‰²æ¨¡å¼åˆ‡æ¢
- [ ] ä¼˜åŒ–å›¾ç‰‡åŠ è½½å’Œç¼“å­˜
- [ ] å®ç°æ¨é€é€šçŸ¥
- [ ] æ·»åŠ  Web ç«¯æ”¯æŒ
- [ ] å®Œå–„ CI/CD æµç¨‹
- [ ] ç¼–å†™æ›´å¤šæµ‹è¯•ç”¨ä¾‹

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

è¯·ç¡®ä¿ï¼š
- ä»£ç é€šè¿‡ `flutter analyze` æ£€æŸ¥
- æ·»åŠ å¿…è¦çš„æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ™ è‡´è°¢

- [TMDB](https://www.themoviedb.org) - æä¾›åŠ¨æ¼«æ•°æ®
- [Supabase](https://supabase.com) - åç«¯æœåŠ¡
- [Flutter](https://flutter.dev) - è·¨å¹³å°æ¡†æ¶
- [DeepSeek](https://www.deepseek.com) - AI æœåŠ¡

---

## ğŸ“§ è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: [https://github.com/yourusername/gismis](https://github.com/yourusername/gismis)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/yourusername/gismis/issues)
- é‚®ç®±: your.email@example.com

---

<div align="center">

**[â¬† å›åˆ°é¡¶éƒ¨](#gismis---åŠ¨æ¼«è¿½ç•ªåŠ©æ‰‹)**

Made with â¤ï¸ by Gismis Team

</div>
